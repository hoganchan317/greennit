<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <title>消息 - Greennit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html{visibility:hidden}</style>
  <style>
    /* 保持与 notifications.html 相同的配色与样式风格 */
  </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
<div class="max-w-6xl mx-auto px-4 py-8">

  {% include "_navbar.html" %}

  <h1 class="text-2xl font-bold mb-4 flex items-center gap-2">
    消息中心
    {% if unread_count and unread_count > 0 %}
      <span class="text-xs px-2 py-0.5 rounded-full bg-red-500 text-white">
        未读 {{ unread_count }}
      </span>
    {% endif %}
  </h1>

  <div class="mb-4 flex justify-between items-center text-sm">
    <div class="text-slate-400">
      共 {{ conversations|length }} 条对话
    </div>
    <div>
      {% if username %}
        <a href="/messages/new" class="text-xs px-3 py-1 rounded bg-emerald-500 hover:bg-emerald-600">新对话</a>
      {% endif %}
    </div>
  </div>

  <div class="space-y-3">
    {% if conversations %}
      {% for c in conversations %}
        <a href="/messages/{{ c.other_username }}" class="rounded-xl p-4 bg-slate-800/80 flex justify-between items-start
                    {% if c.unread_count and c.unread_count > 0 %}border-l-4 border-emerald-400{% else %}border border-slate-700{% endif %}">
          <div class="space-y-1">
            <div class="text-sm font-semibold text-slate-100">{{ c.other_username }}</div>
            <div class="text-xs text-slate-400 max-w-xl truncate">{{ c.last_message }}</div>
          </div>
          <div class="text-right text-xs">
            <div class="text-slate-400">{{ c.last_at.strftime('%Y-%m-%d %H:%M') if c.last_at }}</div>
            {% if c.unread_count and c.unread_count > 0 %}
              <div class="mt-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-red-500 text-white text-xs">{{ c.unread_count }}</div>
            {% endif %}
          </div>
        </a>
      {% endfor %}
    {% else %}
      <div class="bg-slate-800/60 rounded-xl p-6 text-center text-slate-400">
        暂时还没有对话。
      </div>
    {% endif %}
  </div>

</div>

<script>document.documentElement.style.visibility='visible'</script>
</body>
</html>
