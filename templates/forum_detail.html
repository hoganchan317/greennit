<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <title>{{ forum.name }} - Greennit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html{visibility:hidden}</style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
<div class="max-w-6xl mx-auto px-4 py-8">

  {% include "_navbar.html" %}

  <div class="flex gap-6">
    <!-- å·¦ä¾§ä¸»å†…å®¹ -->
    <div class="flex-1">
      <a href="/forums" class="text-slate-400 hover:text-white text-sm">â† è¿”å›è®ºå›åˆ—è¡¨</a>
      
      <div class="flex justify-between items-start mt-2 mb-4">
        <div>
          <h1 class="text-2xl font-bold">{{ forum.name }}</h1>
          {% if forum.description %}
            <p class="text-slate-400">{{ forum.description }}</p>
          {% endif %}
          <div class="text-xs text-slate-500 mt-1">åˆ›å»ºäº {{ forum.created_at.strftime('%Y-%m-%d %H:%M') if forum.created_at else '' }}</div>
        </div>
        <div class="flex gap-2">
          {% if role in ['admin', 'moderator'] %}
            <a href="/forums/{{ forum.id }}/new_post" class="px-4 py-2 rounded bg-emerald-500 hover:bg-emerald-600 text-sm">
              å‘å¸–
            </a>
            <a href="/forums/{{ forum.id }}/members" class="px-4 py-2 rounded bg-slate-700 hover:bg-slate-600 text-sm">
              ç®¡ç†æˆå‘˜
            </a>
          {% elif role == 'member' %}
            <a href="/forums/{{ forum.id }}/new_post" class="px-4 py-2 rounded bg-emerald-500 hover:bg-emerald-600 text-sm">
              å‘å¸–
            </a>
          {% else %}
            <form method="post" action="/forums/join">
              <input type="hidden" name="code" value="{{ forum.invite_code }}">
              <button type="submit" class="px-4 py-2 rounded bg-emerald-500 hover:bg-emerald-600 text-sm">
                åŠ å…¥è®ºå›
              </button>
            </form>
          {% endif %}
        </div>
      </div>

      <!-- é‚€è¯·ç åŒºåŸŸï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰ -->
      {% if role == 'admin' %}
        <div class="bg-slate-800/60 rounded-lg p-3 mb-4 flex justify-between items-center">
          <div>
            <span class="text-slate-400 text-sm">é‚€è¯·ç ï¼š</span>
            <span class="text-emerald-400 font-mono text-lg tracking-widest">{{ forum.invite_code or 'æœªç”Ÿæˆ' }}</span>
            <button onclick="copyInviteLink()" class="ml-2 text-xs text-sky-400 hover:underline">å¤åˆ¶é“¾æ¥</button>
          </div>
        </div>
      {% endif %}

      <!-- å¸–å­åˆ—è¡¨ -->
      <div class="space-y-3">
        {% if posts %}
          {% for p in posts %}
            <a href="/post/{{ p.id }}" class="block p-4 bg-slate-800/80 rounded-xl hover:bg-slate-700/80">
              <div class="font-medium text-lg">{{ p.title }}</div>
              <div class="text-sm text-slate-400 mt-1">{{ p.content[:100] }}{% if p.content|length > 100 %}...{% endif %}</div>
              <div class="flex gap-4 mt-2 text-xs text-slate-500">
                <span>{{ p.author }}</span>
                <span>{{ p.created_at.strftime('%Y-%m-%d %H:%M') if p.created_at else '' }}</span>
                <span>ğŸ’¬ {{ p.comment_count }}</span>
                <span>â¤ï¸ {{ p.like_count }}</span>
              </div>
            </a>
          {% endfor %}
          
          <!-- åˆ†é¡µ -->
          {% if total_pages > 1 %}
            <div class="flex justify-center gap-2 mt-4">
              {% if page > 1 %}
                <a href="/forums/{{ forum.id }}?page={{ page - 1 }}" class="px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-sm">ä¸Šä¸€é¡µ</a>
              {% endif %}
              <span class="px-3 py-1 text-slate-400 text-sm">{{ page }} / {{ total_pages }}</span>
              {% if page < total_pages %}
                <a href="/forums/{{ forum.id }}?page={{ page + 1 }}" class="px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 text-sm">ä¸‹ä¸€é¡µ</a>
              {% endif %}
            </div>
          {% endif %}
        {% else %}
          <div class="bg-slate-800/60 rounded-xl p-6 text-center text-slate-400">
            æš‚æ— å¸–å­ã€‚
            {% if role %}
              <a href="/forums/{{ forum.id }}/new_post" class="text-emerald-400 hover:underline ml-1">å‘å¸ƒç¬¬ä¸€ä¸ªå¸–å­</a>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>

    <!-- å³ä¾§æˆå‘˜åˆ—è¡¨ -->
    <div class="w-64 hidden lg:block">
      <h2 class="text-lg font-bold mb-3">æˆå‘˜ ({{ members|length }})</h2>
      <div class="bg-slate-800/80 rounded-xl p-3 space-y-2 max-h-[60vh] overflow-y-auto">
        {% for m in members %}
          <div class="flex justify-between items-center p-2 rounded hover:bg-slate-700/50">
            <div class="flex items-center gap-1">
              <a href="/user/{{ m.username }}" class="text-sm hover:underline">{{ m.username }}</a>
              {% if m.role == 'admin' %}
                <span class="text-xs text-amber-400">ç®¡ç†</span>
              {% elif m.role == 'moderator' %}
                <span class="text-xs text-sky-400">ç‰ˆä¸»</span>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

</div>

<script>
document.documentElement.style.visibility='visible';

function copyInviteLink() {
    const code = "{{ forum.invite_code or '' }}";
    if (!code) {
        alert('é‚€è¯·ç æœªç”Ÿæˆ');
        return;
    }
    const link = location.origin + '/forums/join?code=' + code;
    navigator.clipboard.writeText(link).then(function() {
        alert('é‚€è¯·é“¾æ¥å·²å¤åˆ¶ï¼');
    }).catch(function() {
        prompt('å¤åˆ¶æ­¤é“¾æ¥:', link);
    });
}
</script>
</body>
</html>